[[ -f ~/.zsh/debug ]] && echo "--- .zshrc" >&2

ZGEN_RESET_ON_CHANGE=(${HOME}/.zshrc)
if [[ ! -r ~/.zsh/zgenom ]] ; then
    git clone https://github.com/jandamm/zgenom.git ~/.zsh/zgenom
fi
source ~/.zsh/zgenom/zgenom.zsh

ZGEN_DIR=${HOME}/.zsh/plugins
mkdir -p "${ZGEN_DIR}"

zgenom autoupdate
if ! zgenom saved ; then
    zgenom load zdharma-continuum/fast-syntax-highlighting
    zgenom load zsh-users/zsh-completions
    zgenom load romkatv/powerlevel10k powerlevel10k

    zgenom load belak/zsh-utils completion
    zgenom load belak/zsh-utils editor

    #zgenom load jandamm/zgenom-ext-eval
    #if [[ -r /opt/homebrew/bin/brew ]] ; then
    #    zgenom eval --name brew-shellenv /opt/homebrew/bin/brew shellenv
    #fi

    zgenom load mroth/evalcache

    zgenom save
fi


alias "ls=ls -F --color=auto"
alias "ll=ls -ltr"
alias "la=ls -ltra"

## Powerlevel10k configuration -- mostly generated by `p10k configure`
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh

ZSH_EVALCACHE_DIR=${HOME}/.zsh/evalcache
mkdir -p "${ZSH_EVALCACHE_DIR}"

if [[ -x /opt/homebrew/bin/brew ]] ; then
    _evalcache /opt/homebrew/bin/brew shellenv
fi

alias dotfiles="GIT_DIR=$HOME/.dotfiles.git GIT_WORK_TREE=$HOME git"

if which nvim &>/dev/null ; then
    alias vi=nvim
    alias vim=nvim
fi

HISTSIZE=11000
SAVEHIST=10000
HISTFILE=~/.history/${HOST%%.*}
if [[ ${USER} != "odellm" && ${USER} != "modell" && ${USER} != "michael" ]] ; then
    HISTFILE+="-${USER}"
fi


# On mac, use the 1Password socket rather than the one set up by launchd when you're local
if [[ ${SSH_AUTH_SOCK} =~ ^/private/tmp/com.apple.launchd \
    && -S "${HOME}/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock" ]] ; then

    SSH_AUTH_SOCK="${HOME}/Library/Group Containers/2BUA8C4S2C.com.1password/t/agent.sock"
fi
